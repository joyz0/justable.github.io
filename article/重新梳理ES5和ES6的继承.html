<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>引言 | 听鱼的博客</title>
    <meta name="description" content="随便玩玩">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/assets/css/0.styles.341cfc29.css" as="style"><link rel="preload" href="/assets/js/app.ac86cec6.js" as="script"><link rel="preload" href="/assets/js/2.252cdd46.js" as="script"><link rel="preload" href="/assets/js/7.5df7dc06.js" as="script"><link rel="prefetch" href="/assets/js/10.31410bdd.js"><link rel="prefetch" href="/assets/js/11.478ec704.js"><link rel="prefetch" href="/assets/js/12.2879fe12.js"><link rel="prefetch" href="/assets/js/13.85b38d03.js"><link rel="prefetch" href="/assets/js/14.5b74d03e.js"><link rel="prefetch" href="/assets/js/15.dfd5a29a.js"><link rel="prefetch" href="/assets/js/16.a43e8f4c.js"><link rel="prefetch" href="/assets/js/17.380e2a17.js"><link rel="prefetch" href="/assets/js/18.08a41da1.js"><link rel="prefetch" href="/assets/js/19.b563ac14.js"><link rel="prefetch" href="/assets/js/20.df90f6e8.js"><link rel="prefetch" href="/assets/js/21.7168bb03.js"><link rel="prefetch" href="/assets/js/22.3dc5e715.js"><link rel="prefetch" href="/assets/js/23.b6683664.js"><link rel="prefetch" href="/assets/js/24.670c644b.js"><link rel="prefetch" href="/assets/js/25.a69f4971.js"><link rel="prefetch" href="/assets/js/26.69a2554d.js"><link rel="prefetch" href="/assets/js/27.47ad26c2.js"><link rel="prefetch" href="/assets/js/28.c9e292ad.js"><link rel="prefetch" href="/assets/js/29.9d6aa331.js"><link rel="prefetch" href="/assets/js/3.47545079.js"><link rel="prefetch" href="/assets/js/30.6810e631.js"><link rel="prefetch" href="/assets/js/31.0dfedae3.js"><link rel="prefetch" href="/assets/js/32.356c2bf5.js"><link rel="prefetch" href="/assets/js/33.2e8a3087.js"><link rel="prefetch" href="/assets/js/34.8c1b3bc5.js"><link rel="prefetch" href="/assets/js/35.908b2c2c.js"><link rel="prefetch" href="/assets/js/36.bcb82981.js"><link rel="prefetch" href="/assets/js/37.127513d9.js"><link rel="prefetch" href="/assets/js/38.19b5947a.js"><link rel="prefetch" href="/assets/js/39.55980509.js"><link rel="prefetch" href="/assets/js/4.1ae7caa5.js"><link rel="prefetch" href="/assets/js/40.a3a20fe0.js"><link rel="prefetch" href="/assets/js/41.342dc1a7.js"><link rel="prefetch" href="/assets/js/42.db0fb602.js"><link rel="prefetch" href="/assets/js/43.b2a4bbf8.js"><link rel="prefetch" href="/assets/js/44.a255d195.js"><link rel="prefetch" href="/assets/js/45.fdda84a6.js"><link rel="prefetch" href="/assets/js/46.77beaa14.js"><link rel="prefetch" href="/assets/js/47.66c0136a.js"><link rel="prefetch" href="/assets/js/48.98735917.js"><link rel="prefetch" href="/assets/js/49.18b1731e.js"><link rel="prefetch" href="/assets/js/5.57f52d01.js"><link rel="prefetch" href="/assets/js/50.04918663.js"><link rel="prefetch" href="/assets/js/51.d9610da1.js"><link rel="prefetch" href="/assets/js/52.98368cb7.js"><link rel="prefetch" href="/assets/js/53.4bd1e23a.js"><link rel="prefetch" href="/assets/js/54.a9f9a734.js"><link rel="prefetch" href="/assets/js/55.f9bd3305.js"><link rel="prefetch" href="/assets/js/56.d322e382.js"><link rel="prefetch" href="/assets/js/57.1d84ce4c.js"><link rel="prefetch" href="/assets/js/58.db405b79.js"><link rel="prefetch" href="/assets/js/59.58571988.js"><link rel="prefetch" href="/assets/js/6.86d421e4.js"><link rel="prefetch" href="/assets/js/60.1201a4a8.js"><link rel="prefetch" href="/assets/js/61.d99e0878.js"><link rel="prefetch" href="/assets/js/62.f758ea0d.js"><link rel="prefetch" href="/assets/js/63.43189fa3.js"><link rel="prefetch" href="/assets/js/64.1d1d0ee5.js"><link rel="prefetch" href="/assets/js/65.4587c83c.js"><link rel="prefetch" href="/assets/js/66.7b522066.js"><link rel="prefetch" href="/assets/js/67.ecac5e24.js"><link rel="prefetch" href="/assets/js/68.2366a631.js"><link rel="prefetch" href="/assets/js/69.c86197d7.js"><link rel="prefetch" href="/assets/js/70.9463c0f5.js"><link rel="prefetch" href="/assets/js/71.4d21c4ea.js"><link rel="prefetch" href="/assets/js/72.a51d04a5.js"><link rel="prefetch" href="/assets/js/73.51c127d2.js"><link rel="prefetch" href="/assets/js/74.96c415f4.js"><link rel="prefetch" href="/assets/js/75.7ac7638c.js"><link rel="prefetch" href="/assets/js/76.c5f7f115.js"><link rel="prefetch" href="/assets/js/77.11c91800.js"><link rel="prefetch" href="/assets/js/78.d9e95626.js"><link rel="prefetch" href="/assets/js/79.31c361bf.js"><link rel="prefetch" href="/assets/js/8.c8be2289.js"><link rel="prefetch" href="/assets/js/80.eb45d592.js"><link rel="prefetch" href="/assets/js/81.ac9f936d.js"><link rel="prefetch" href="/assets/js/82.0056fbce.js"><link rel="prefetch" href="/assets/js/83.31a59a7a.js"><link rel="prefetch" href="/assets/js/84.0988deeb.js"><link rel="prefetch" href="/assets/js/85.5d16e68b.js"><link rel="prefetch" href="/assets/js/86.9f34b304.js"><link rel="prefetch" href="/assets/js/87.282f736e.js"><link rel="prefetch" href="/assets/js/88.d79f840c.js"><link rel="prefetch" href="/assets/js/89.6568e137.js"><link rel="prefetch" href="/assets/js/9.79aa832c.js"><link rel="prefetch" href="/assets/js/90.5ecb5a3e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.341cfc29.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">听鱼的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/article/浅谈JS中的AST.html" class="nav-link">
  文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/html5/BrowsingContext.html" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/basic/css3/flex.html" class="nav-link">
  CSS3
</a></li><li class="dropdown-item"><!----> <a href="/basic/javascript/作用域.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/basic/nodejs/作用域.html" class="nav-link">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/basic/typescript/basic.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/basic/browser/cors.html" class="nav-link">
  Browser
</a></li><li class="dropdown-item"><!----> <a href="/basic/webpack/webpack4.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/basic/react/react-kernel.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/basic/vue/vue-loader.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/basic/minip/FAQ.html" class="nav-link">
  Minip
</a></li><li class="dropdown-item"><!----> <a href="/basic/network/TCPIP.html" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/basic/git/command.html" class="nav-link">
  Git
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/article/浅谈JS中的AST.html" class="nav-link">
  文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/html5/BrowsingContext.html" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/basic/css3/flex.html" class="nav-link">
  CSS3
</a></li><li class="dropdown-item"><!----> <a href="/basic/javascript/作用域.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/basic/nodejs/作用域.html" class="nav-link">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/basic/typescript/basic.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/basic/browser/cors.html" class="nav-link">
  Browser
</a></li><li class="dropdown-item"><!----> <a href="/basic/webpack/webpack4.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/basic/react/react-kernel.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/basic/vue/vue-loader.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/basic/minip/FAQ.html" class="nav-link">
  Minip
</a></li><li class="dropdown-item"><!----> <a href="/basic/network/TCPIP.html" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/basic/git/command.html" class="nav-link">
  Git
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/article/浅谈JS中的AST.html" class="sidebar-link">浅谈JS中的AST</a></li><li><a href="/article/实现一个简单的WEB打包工具.html" class="sidebar-link">实现一个简单的WEB打包工具</a></li><li><a href="/article/解析vue3的响应式.html" class="sidebar-link">解析vue3的响应式</a></li><li><a href="/article/重新梳理ES5和ES6的继承.html" class="active sidebar-link">重新梳理ES5和ES6的继承</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/重新梳理ES5和ES6的继承.html#引言" class="sidebar-link">引言</a></li><li class="sidebar-sub-header"><a href="/article/重新梳理ES5和ES6的继承.html#脑子卡壳的地方" class="sidebar-link">脑子卡壳的地方</a></li><li class="sidebar-sub-header"><a href="/article/重新梳理ES5和ES6的继承.html#es5-的几种继承方式" class="sidebar-link">ES5 的几种继承方式</a></li><li class="sidebar-sub-header"><a href="/article/重新梳理ES5和ES6的继承.html#es6-的继承方式" class="sidebar-link">ES6 的继承方式</a></li><li class="sidebar-sub-header"><a href="/article/重新梳理ES5和ES6的继承.html#es6-继承与-es5-继承的核心差异" class="sidebar-link">ES6 继承与 ES5 继承的核心差异</a></li><li class="sidebar-sub-header"><a href="/article/重新梳理ES5和ES6的继承.html#回到最初的例子" class="sidebar-link">回到最初的例子</a></li></ul></li><li><a href="/article/Jest源码整理.html" class="sidebar-link">Jest源码整理</a></li><li><a href="/article/什么是句柄.html" class="sidebar-link">什么是句柄</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="引言"><a href="#引言" class="header-anchor">#</a> 引言</h2> <p>在看一段源码时，竟然看懵了，决定完整梳理下 ES5 和 ES6 的继承知识。</p> <p>源码结构是这样的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> params<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">apply</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> thisArg<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> target<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hello</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>我就惊了个呆。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>为了便于表述，后文统一称呼 class 式继承为 ES6 继承，prototype 式继承为 ES5 继承。</p></div> <h2 id="脑子卡壳的地方"><a href="#脑子卡壳的地方" class="header-anchor">#</a> 脑子卡壳的地方</h2> <p>我惊呆了必然是由于对某个基础知识没有完全理顺，我希望自己能从基础知识出发，自然而然的理解这段代码，而不是从代码的最终效果反推一些原理特性。因此本文重新梳理一下 ES5 和 ES6 的继承。关于原型链就不梳理了，它在我脑中已经梳理的不能再顺了 😂。</p> <p>说出这段源码的目的并不难，只要一运行看下效果就知道了，效果是使得所有的 Foo 实例是 Callable 的，并且调用时会执行 handle 方法。</p> <p>但是 Foo 的实例 foo 为什么是个函数，就因为继承了 Function？我接着使用 ES5 的“寄生组合式继承”方式<a href="#%E5%9B%9E%E5%88%B0%E6%9C%80%E5%88%9D%E7%9A%84%E4%BE%8B%E5%AD%90">实现了一遍</a>上述代码，发现运行结果不同。</p> <h2 id="es5-的几种继承方式"><a href="#es5-的几种继承方式" class="header-anchor">#</a> ES5 的几种继承方式</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>JS 中的所有 function 都继承自 Function，所以<code>customFunc.__proto__ === Function.prototype</code>，但基于 class 的 ES6 继承则不同，<a href="#es6-%E7%BB%A7%E6%89%BF%E4%B8%8E-es5-%E7%BB%A7%E6%89%BF%E7%9A%84%E6%A0%B8%E5%BF%83%E5%B7%AE%E5%BC%82">后文</a>会说明。</p></div> <p>继承要达到两点：</p> <ol><li>父类的实例属性被继承</li> <li>父类的原型方法被继承</li></ol> <p>首先定义一个父类：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sign <span class="token operator">=</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">logName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>sign<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)名字: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="借用构造函数继承"><a href="#借用构造函数继承" class="header-anchor">#</a> 借用构造函数继承</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Singer</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> debut</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sign <span class="token operator">=</span> <span class="token string">&quot;Singer&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>debut <span class="token operator">=</span> debut<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Singer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">logDebut</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>sign<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)出道年份: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>debut<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> jay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singer</span><span class="token punctuation">(</span><span class="token string">&quot;Jay&quot;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jay<span class="token punctuation">.</span><span class="token function">logDebut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (Singer)出道年份: 2000</span>
jay<span class="token punctuation">.</span><span class="token function">logName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// jay.logName is not a function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>没有继承父类的原型方法</p> <h3 id="原型链继承"><a href="#原型链继承" class="header-anchor">#</a> 原型链继承</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Singer</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> debut</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sign <span class="token operator">=</span> <span class="token string">&quot;Singer&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token comment">// 需要增加这一行</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>debut <span class="token operator">=</span> debut<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Singer</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Singer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constuctor <span class="token operator">=</span> Singer<span class="token punctuation">;</span>
<span class="token class-name">Singer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">logDebut</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>sign<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)出道年份: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>debut<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> jay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singer</span><span class="token punctuation">(</span><span class="token string">&quot;Jay&quot;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jay<span class="token punctuation">.</span><span class="token function">logDebut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (Singer)出道年份: 2000</span>
jay<span class="token punctuation">.</span><span class="token function">logName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (Singer)名字: Jay</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>无法自动继承父类的实例属性，得在子类中手动重新定义一遍，并且子类的原型会出现父类的实例属性</p> <h3 id="组合继承"><a href="#组合继承" class="header-anchor">#</a> 组合继承</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Singer</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> debut</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sign <span class="token operator">=</span> <span class="token string">&quot;Singer&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>debut <span class="token operator">=</span> debut<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Singer</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Singer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constuctor <span class="token operator">=</span> Singer<span class="token punctuation">;</span>
<span class="token class-name">Singer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">logDebut</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>sign<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)出道年份: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>debut<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> jay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singer</span><span class="token punctuation">(</span><span class="token string">&quot;Jay&quot;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jay<span class="token punctuation">.</span><span class="token function">logDebut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (Singer)出道年份: 2000</span>
jay<span class="token punctuation">.</span><span class="token function">logName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (Singer)名字: Jay</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>没有完全解决“原型链继承”的问题，子类的原型会出现父类的实例属性</p> <p><img src="/assets/img/inherit_1.b1831e9a.png" alt=""></p> <h3 id="寄生组合式继承"><a href="#寄生组合式继承" class="header-anchor">#</a> 寄生组合式继承</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Singer</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> debut</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sign <span class="token operator">=</span> <span class="token string">&quot;Singer&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>debut <span class="token operator">=</span> debut<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Singer</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Singer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constuctor <span class="token operator">=</span> Singer<span class="token punctuation">;</span>
<span class="token class-name">Singer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">logDebut</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>sign<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)出道年份: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>debut<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> jay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singer</span><span class="token punctuation">(</span><span class="token string">&quot;Jay&quot;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jay<span class="token punctuation">.</span><span class="token function">logDebut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (Singer)出道年份: 2000</span>
jay<span class="token punctuation">.</span><span class="token function">logName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (Singer)名字: Jay</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>解决了上述问题，此方法也是 ES5 中比较成熟的继承方式</p> <p><img src="/assets/img/inherit_2.d5ac7c51.png" alt=""></p> <h2 id="es6-的继承方式"><a href="#es6-的继承方式" class="header-anchor">#</a> ES6 的继承方式</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  sign <span class="token operator">=</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">logName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>sign<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)名字: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Singer</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  sign <span class="token operator">=</span> <span class="token string">&quot;Singer&quot;</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> debut</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>debut <span class="token operator">=</span> debut<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">logDebut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>sign<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)出道年份: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>debut<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> jay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singer</span><span class="token punctuation">(</span><span class="token string">&quot;Jay&quot;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jay<span class="token punctuation">.</span><span class="token function">logDebut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (Singer)出道年份: 2000</span>
jay<span class="token punctuation">.</span><span class="token function">logName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (Singer)名字: Jay</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><img src="/assets/img/inherit_3.5014085e.png" alt=""></p> <p>ES6 继承中的 class 不同于 Java 的 class，它只是一个语法糖，本质依然是基于 prototype 的，但比 ES5 继承更直观和简洁，并且只能通过 new 关键字创建。</p> <h2 id="es6-继承与-es5-继承的核心差异"><a href="#es6-继承与-es5-继承的核心差异" class="header-anchor">#</a> ES6 继承与 ES5 继承的核心差异</h2> <p>在 ES5 继承中，会优先创建子类的实例对象 this，再通过<code>Person.call(this)</code>将父类构造函数中的实例属性附加到这个 this 上；</p> <p>在 ES6 继承中，会通过<code>super()</code>追溯到最顶层的构造函数，优先创建顶层的实例对象 this，再通过子类的构造函数修改这个 this。</p> <p>除了 this 的不同，还有个不能忽视的区别，ES6 继承中，子类的<code>__proto__</code>将指向父类<code>Person</code>，而不是<code>Function.prototype</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 寄生组合事继承</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Singer<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// ES6 继承</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Singer<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> Person<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="回到最初的例子"><a href="#回到最初的例子" class="header-anchor">#</a> 回到最初的例子</h2> <p>最开始的例子，如果用 ES5 继承如何实现？</p> <p>我的第一直觉是这么写的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Function</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> params<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">apply</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> thisArg<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> target<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Foo<span class="token punctuation">;</span>
Foo<span class="token punctuation">.</span>prorotype<span class="token punctuation">.</span><span class="token function-variable function">handle</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo is not a function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>咋一看没什么问题，但是运行出错了，原因正是 ES5 继承和 ES6 继承的 this 创建时机不同导致，ES5 继承的 this 是在 Foo 的构造函数中创建的，最终是个对象；ES6 继承的 this 是在顶层 Function 的构造函数中创建的，最终是个函数。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/article/解析vue3的响应式.html" class="prev">
        解析vue3的响应式
      </a></span> <span class="next"><a href="/article/Jest源码整理.html">
        Jest源码整理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ac86cec6.js" defer></script><script src="/assets/js/2.252cdd46.js" defer></script><script src="/assets/js/7.5df7dc06.js" defer></script>
  </body>
</html>
