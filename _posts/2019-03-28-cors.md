---
title:  "CORS"
date:   2018-03-28 10:57:00
categories: [blog]
tags: [CORS]
---

### 引言
跨域问题是浏览器器的同源策略导致的，不是HTTP协议的一部分，所以它只存在于浏览器。

### 同源策略
域名（或IP），协议，端口都相同

### 跨域判定流程
1. Site A请求Site B
2. Site B按需在响应头中返回Access-Control-Allow-Origin
3. Browser根据Access-Control-Allow-Origin判断当前origin是否被包含在内，是则允许此次请求，反之trigger the XMLHttpRequest's error event and deny the response data to the requesting
[参考](1)

### Excepts(这些不会触发跨域判定)
images, scripts, stylesheets, iframes, form submissions etc

### CSRF Tokens(Excepts情况实现跨域拦截)
e.g.
```html
<img src="third-part website"/>
```
Browser尝试向url加载图片，它会发送GET请求并发送所有cookies，为了阻止这种行为，我们需要服务端进行防护措施。通常的做法是，服务端生成一个随机唯一的token放到用户session中，并发送给browser，页面请求图片是附带上此token，最后服务端验证token的有效性。p.s.因为第三方网站是拿不到token的。

### Node中的跨域代理proxyTable
vue-cli的proxyTable用的是http-proxy-middleware中间件
create-react-app用的是webpack-dev-server内部也是用的http-proxy-middleware
http-proxy-middleware内部用的http-proxy

### Why CORS not exists in Back-End
在浏览器端跨域，可能导致获取到其他网站的敏感信息或者越权操作，比如拿到银行的登录状态或者执行转账操作，所以应当禁止。
服务端跨域没有这个问题，因为用户的这些状态信息都是在浏览器端保存的，服务器只能有自己网站的状态信息。

[1]: https://stackoverflow.com/questions/10636611/how-does-access-control-allow-origin-header-work/10636765#10636765
[2]: https://en.wikipedia.org/wiki/Cross-origin_resource_sharing
