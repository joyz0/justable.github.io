(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{252:function(t,e,s){t.exports=s.p+"assets/img/debug_remote.4ef97865.png"},253:function(t,e,s){t.exports=s.p+"assets/img/debug_chrome.f4d5e111.png"},334:function(t,e,s){"use strict";s.r(e);var r=s(28),a=Object(r.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),r("p",[r("a",{attrs:{href:"https://nodejs.org/en/docs/guides/debugging-getting-started/",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文"),r("OutboundLink")],1)])]),t._v(" "),r("h2",{attrs:{id:"调试模型"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#调试模型"}},[t._v("#")]),t._v(" 调试模型")]),t._v(" "),r("p",[t._v("NodeJS 的调试模型有两个组成部分：")]),t._v(" "),r("ol",[r("li",[t._v("调试进程：对程序有着控制权，监听 host+port，接收来自客户端的指令信息")]),t._v(" "),r("li",[t._v("调试客户端：通过 host+port+UUID，向调试进程发起具体指令")])]),t._v(" "),r("h2",{attrs:{id:"开启调试模式"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#开启调试模式"}},[t._v("#")]),t._v(" 开启调试模式")]),t._v(" "),r("ul",[r("li",[t._v("node --inspect xxx.js")])]),t._v(" "),r("p",[t._v("此命令会开启一个 debug 进程，并且标识唯一的 UUID，默认监听 127.0.0.1:9229。")]),t._v(" "),r("h2",{attrs:{id:"安全性"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#安全性"}},[t._v("#")]),t._v(" 安全性")]),t._v(" "),r("p",[t._v("因为调试进程有着对程序执行环境完全的控制权，这就导致了恶意攻击者可以通过访问指定的 host+port 向调试进程发起指令进而控制该程序。")]),t._v(" "),r("p",[t._v("所以我们应该避免让调试进程监听 Public IP 或 0.0.0.0。")]),t._v(" "),r("h2",{attrs:{id:"远程调试"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#远程调试"}},[t._v("#")]),t._v(" 远程调试")]),t._v(" "),r("ol",[r("li",[t._v("远程服务器执行 node --inspect server.js")]),t._v(" "),r("li",[t._v("本地执行 ssh -L 9221:localhost:9229 user@remote.example.com（表示将本地的 9221 端口信息转发到远程服务器的 9229 端口），建立一个 ssh 隧道，之后将调试客户端 attach 到 localhost:9221，参考后文的浏览器或 VSCode 方案调试")])]),t._v(" "),r("p",[r("img",{attrs:{src:s(252),alt:""}})]),t._v(" "),r("h2",{attrs:{id:"常见调试客户端"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#常见调试客户端"}},[t._v("#")]),t._v(" 常见调试客户端")]),t._v(" "),r("h3",{attrs:{id:"浏览器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#浏览器"}},[t._v("#")]),t._v(" 浏览器")]),t._v(" "),r("ol",[r("li",[t._v("执行"),r("code",[t._v("node --inspect")]),t._v("命令")]),t._v(" "),r("li",[t._v("在浏览器中打开"),r("code",[t._v("chrome://inspect")]),t._v("，点击指定调试进程的 inspect 按钮")])]),t._v(" "),r("p",[r("img",{attrs:{src:s(253),alt:""}})]),t._v(" "),r("h3",{attrs:{id:"vscode"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#vscode"}},[t._v("#")]),t._v(" VSCode")]),t._v(" "),r("p",[t._v("跳转"),r("RouterLink",{attrs:{to:"/article/在VSCode中debug.html"}},[t._v("文章")])],1),t._v(" "),r("h2",{attrs:{id:"常见命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#常见命令"}},[t._v("#")]),t._v(" 常见命令")]),t._v(" "),r("ul",[r("li",[t._v("--inspect\n"),r("ul",[r("li",[t._v("Enable inspector agent")]),t._v(" "),r("li",[t._v("Listen on default address and port (127.0.0.1:9229)")])])]),t._v(" "),r("li",[t._v("--inspect=[host:port]\n"),r("ul",[r("li",[t._v("Enable inspector agent")]),t._v(" "),r("li",[t._v("Bind to address or hostname host (default: 127.0.0.1)")]),t._v(" "),r("li",[t._v("Listen on port port (default: 9229)")])])]),t._v(" "),r("li",[t._v("--inspect-brk\n"),r("ul",[r("li",[t._v("Enable inspector agent")]),t._v(" "),r("li",[t._v("Listen on default address and port (127.0.0.1:9229)")]),t._v(" "),r("li",[t._v("Break before user code starts")])])]),t._v(" "),r("li",[t._v("--inspect-brk=[host:port]\n"),r("ul",[r("li",[t._v("Enable inspector agent")]),t._v(" "),r("li",[t._v("Bind to address or hostname host (default: 127.0.0.1)")]),t._v(" "),r("li",[t._v("Listen on port port (default: 9229)")]),t._v(" "),r("li",[t._v("Break before user code starts")])])]),t._v(" "),r("li",[t._v("node inspect script.js\n"),r("ul",[r("li",[t._v("Spawn child process to run user's script under --inspect flag; and use main process to run CLI debugger")])])]),t._v(" "),r("li",[t._v("node inspect --port=xxxx script.js\n"),r("ul",[r("li",[t._v("Spawn child process to run user's script under --inspect flag; and use main process to run CLI debugger")]),t._v(" "),r("li",[t._v("Listen on port port (default: 9229)")])])])])])}),[],!1,null,null,null);e.default=a.exports}}]);