---
title:  "未登录调用接口时弹登录框"
date:   2019-07-03 9:29:00
categories: [blog]
tags: [app]
---

### 需求
当前台调用需要登录状态的接口时，若此时未登录，要么直接重定向到登陆界面，但是这样在登录后很难回到之前的页面，且交互不友好；另一种是直接在当前页弹登录框，淘宝就是如此，登录后刷新当前页即可。我选择第二种方案。

### 未登录时弹登录框
场景是一个react项目，请求用了axios库。
1. 在每个接口的回调函数中判断后台返回的标识，然后选择是否弹框，但是如此逻辑散落在各个请求的回调中，难以维护。
2. 在axios的拦截response中判断，但是axios的拦截配置在一个单独的js文件中，并非react组件，如何操控弹框？  
    1. 使用redux通信，将登录框组件在layout.jsx中引入，并依赖redux库中的是否可见变量。
    2. 将axios封装成不可见的虚拟组件，登录框组件集成在axios组件中，然后connect到局部组件中以供调用，但如此非常麻烦，且会有很多connect。
    3. 将axios封装成不可见的虚拟组件，登录框组件集成在axios组件中，在layout中引入，依靠context传递给子组件。

上述方案都是我依情景所想，感觉并非最优解，倾向于2.1。  
引申出一个额外的感悟，在代码层面不管如何优化，最终都是把一段逻辑抽离到一个公共文件或统一入口中维护，实际效果是，这一个公共文件或统一入口依然需要被每个业务文件所引入，新增一个业务文件时，依然需要重新引入那个公共文件。    
我觉得把这些公共逻辑放到编译层，才能真正的解放对公共逻辑维护与引入，比如next.js的路由，只需在page文件夹中放置页面文件即可。当然这扯远了，未登录是弹登录框并不需要如此大动干戈。