<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>听鱼的博客</title>
    <meta name="description" content="随便玩玩">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/assets/css/0.styles.341cfc29.css" as="style"><link rel="preload" href="/assets/js/app.5f1549a3.js" as="script"><link rel="preload" href="/assets/js/2.9121317e.js" as="script"><link rel="preload" href="/assets/js/6.624eac56.js" as="script"><link rel="prefetch" href="/assets/js/10.2b223f51.js"><link rel="prefetch" href="/assets/js/100.88f34131.js"><link rel="prefetch" href="/assets/js/101.7bd5d049.js"><link rel="prefetch" href="/assets/js/102.a2416ce9.js"><link rel="prefetch" href="/assets/js/103.b99a3983.js"><link rel="prefetch" href="/assets/js/104.7b14bb74.js"><link rel="prefetch" href="/assets/js/105.48cc9c64.js"><link rel="prefetch" href="/assets/js/106.f5c5fdef.js"><link rel="prefetch" href="/assets/js/107.db559f47.js"><link rel="prefetch" href="/assets/js/11.b41c262c.js"><link rel="prefetch" href="/assets/js/12.11ed69d3.js"><link rel="prefetch" href="/assets/js/13.c3ce1a72.js"><link rel="prefetch" href="/assets/js/14.c76f109f.js"><link rel="prefetch" href="/assets/js/15.a64e573f.js"><link rel="prefetch" href="/assets/js/16.e7fa5866.js"><link rel="prefetch" href="/assets/js/17.064422d1.js"><link rel="prefetch" href="/assets/js/18.02f8761b.js"><link rel="prefetch" href="/assets/js/19.11713135.js"><link rel="prefetch" href="/assets/js/20.9aa94593.js"><link rel="prefetch" href="/assets/js/21.a0315b58.js"><link rel="prefetch" href="/assets/js/22.3304311a.js"><link rel="prefetch" href="/assets/js/23.43780215.js"><link rel="prefetch" href="/assets/js/24.03bcab68.js"><link rel="prefetch" href="/assets/js/25.3892ef13.js"><link rel="prefetch" href="/assets/js/26.7368c3c8.js"><link rel="prefetch" href="/assets/js/27.a447d7a3.js"><link rel="prefetch" href="/assets/js/28.688769d3.js"><link rel="prefetch" href="/assets/js/29.0f5ae53c.js"><link rel="prefetch" href="/assets/js/3.e37f38d1.js"><link rel="prefetch" href="/assets/js/30.835875d4.js"><link rel="prefetch" href="/assets/js/31.d1ebe3d5.js"><link rel="prefetch" href="/assets/js/32.451262e0.js"><link rel="prefetch" href="/assets/js/33.a6fda2b8.js"><link rel="prefetch" href="/assets/js/34.fd67c298.js"><link rel="prefetch" href="/assets/js/35.8cc1d6d7.js"><link rel="prefetch" href="/assets/js/36.ef518f55.js"><link rel="prefetch" href="/assets/js/37.9cd39257.js"><link rel="prefetch" href="/assets/js/38.86233114.js"><link rel="prefetch" href="/assets/js/39.877da125.js"><link rel="prefetch" href="/assets/js/4.e6414d4d.js"><link rel="prefetch" href="/assets/js/40.70dc3d39.js"><link rel="prefetch" href="/assets/js/41.e1a77180.js"><link rel="prefetch" href="/assets/js/42.dbc31dcd.js"><link rel="prefetch" href="/assets/js/43.3871485c.js"><link rel="prefetch" href="/assets/js/44.4449b2e0.js"><link rel="prefetch" href="/assets/js/45.3d48d78f.js"><link rel="prefetch" href="/assets/js/46.9a3471ee.js"><link rel="prefetch" href="/assets/js/47.3b6bfa4c.js"><link rel="prefetch" href="/assets/js/48.9da4ab43.js"><link rel="prefetch" href="/assets/js/49.1ab258d8.js"><link rel="prefetch" href="/assets/js/5.768ecfb1.js"><link rel="prefetch" href="/assets/js/50.209cafdb.js"><link rel="prefetch" href="/assets/js/51.0456622a.js"><link rel="prefetch" href="/assets/js/52.85a0550e.js"><link rel="prefetch" href="/assets/js/53.223fb839.js"><link rel="prefetch" href="/assets/js/54.5ea04027.js"><link rel="prefetch" href="/assets/js/55.a283b62f.js"><link rel="prefetch" href="/assets/js/56.ff2d36de.js"><link rel="prefetch" href="/assets/js/57.96dd32d6.js"><link rel="prefetch" href="/assets/js/58.a29947e9.js"><link rel="prefetch" href="/assets/js/59.8f0833b9.js"><link rel="prefetch" href="/assets/js/60.4ce1076c.js"><link rel="prefetch" href="/assets/js/61.31fcfa18.js"><link rel="prefetch" href="/assets/js/62.08614913.js"><link rel="prefetch" href="/assets/js/63.b8066b11.js"><link rel="prefetch" href="/assets/js/64.2300a12e.js"><link rel="prefetch" href="/assets/js/65.cf63b8ca.js"><link rel="prefetch" href="/assets/js/66.798e9bc2.js"><link rel="prefetch" href="/assets/js/67.8744354c.js"><link rel="prefetch" href="/assets/js/68.91664d01.js"><link rel="prefetch" href="/assets/js/69.b117396d.js"><link rel="prefetch" href="/assets/js/7.ec318c6d.js"><link rel="prefetch" href="/assets/js/70.ddc2e5ee.js"><link rel="prefetch" href="/assets/js/71.80515641.js"><link rel="prefetch" href="/assets/js/72.1c50e6a9.js"><link rel="prefetch" href="/assets/js/73.df5031bc.js"><link rel="prefetch" href="/assets/js/74.30e6d9e4.js"><link rel="prefetch" href="/assets/js/75.88aab629.js"><link rel="prefetch" href="/assets/js/76.8d1ed4d2.js"><link rel="prefetch" href="/assets/js/77.7de6bbe9.js"><link rel="prefetch" href="/assets/js/78.667bf803.js"><link rel="prefetch" href="/assets/js/79.52f48ae6.js"><link rel="prefetch" href="/assets/js/8.5f713608.js"><link rel="prefetch" href="/assets/js/80.470e5818.js"><link rel="prefetch" href="/assets/js/81.15db1e32.js"><link rel="prefetch" href="/assets/js/82.f7534eb2.js"><link rel="prefetch" href="/assets/js/83.4cd16380.js"><link rel="prefetch" href="/assets/js/84.9e4cf4b7.js"><link rel="prefetch" href="/assets/js/85.2daeb56c.js"><link rel="prefetch" href="/assets/js/86.62c75f2a.js"><link rel="prefetch" href="/assets/js/87.f4038b2d.js"><link rel="prefetch" href="/assets/js/88.30c294eb.js"><link rel="prefetch" href="/assets/js/89.ff8e509c.js"><link rel="prefetch" href="/assets/js/9.0adc4cd7.js"><link rel="prefetch" href="/assets/js/90.84efa137.js"><link rel="prefetch" href="/assets/js/91.b8ca7db3.js"><link rel="prefetch" href="/assets/js/92.5ecfca64.js"><link rel="prefetch" href="/assets/js/93.50b8a095.js"><link rel="prefetch" href="/assets/js/94.920b2d6c.js"><link rel="prefetch" href="/assets/js/95.1951a5fe.js"><link rel="prefetch" href="/assets/js/96.37e4257f.js"><link rel="prefetch" href="/assets/js/97.1171a0e1.js"><link rel="prefetch" href="/assets/js/98.5f53030b.js"><link rel="prefetch" href="/assets/js/99.29d49bbc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.341cfc29.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">听鱼的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/article/浅谈JS中的AST.html" class="nav-link">
  文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/html5/BrowsingContext.html" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/basic/css3/flex.html" class="nav-link">
  CSS3
</a></li><li class="dropdown-item"><!----> <a href="/basic/javascript/作用域.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/basic/nodejs/作用域.html" class="nav-link">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/basic/typescript/basic.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/basic/browser/cors.html" class="nav-link">
  Browser
</a></li><li class="dropdown-item"><!----> <a href="/basic/webpack/webpack4.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/basic/react/react-kernel.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/basic/vue/vue-loader.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/basic/minip/FAQ.html" class="nav-link">
  Minip
</a></li><li class="dropdown-item"><!----> <a href="/basic/network/" class="nav-link router-link-active">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/basic/git/command.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/basic/docker/基础篇.html" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/basic/db/范式.html" class="nav-link">
  DataBase
</a></li><li class="dropdown-item"><!----> <a href="/basic/linux/bash.html" class="nav-link">
  Linux
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/article/浅谈JS中的AST.html" class="nav-link">
  文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/html5/BrowsingContext.html" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/basic/css3/flex.html" class="nav-link">
  CSS3
</a></li><li class="dropdown-item"><!----> <a href="/basic/javascript/作用域.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/basic/nodejs/作用域.html" class="nav-link">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/basic/typescript/basic.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/basic/browser/cors.html" class="nav-link">
  Browser
</a></li><li class="dropdown-item"><!----> <a href="/basic/webpack/webpack4.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/basic/react/react-kernel.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/basic/vue/vue-loader.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/basic/minip/FAQ.html" class="nav-link">
  Minip
</a></li><li class="dropdown-item"><!----> <a href="/basic/network/" class="nav-link router-link-active">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/basic/git/command.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/basic/docker/基础篇.html" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/basic/db/范式.html" class="nav-link">
  DataBase
</a></li><li class="dropdown-item"><!----> <a href="/basic/linux/bash.html" class="nav-link">
  Linux
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML5</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/html5/BrowsingContext.html" class="sidebar-link">浏览器上下文</a></li><li><a href="/basic/html5/Window.html" class="sidebar-link">Window</a></li><li><a href="/basic/html5/WebWorkers.html" class="sidebar-link">Web Workers</a></li><li><a href="/basic/html5/MessageChannel.html" class="sidebar-link">MessageChannel</a></li><li><a href="/basic/html5/MessagePort.html" class="sidebar-link">MessagePort</a></li><li><a href="/basic/html5/HTMLTemplateElement.html" class="sidebar-link">HTMLTemplateElement</a></li><li><a href="/basic/html5/h5.html" class="sidebar-link">移动端</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS3</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/css3/flex.html" class="sidebar-link">flex布局</a></li><li><a href="/basic/css3/FAQ.html" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/javascript/作用域.html" class="sidebar-link">作用域</a></li><li><a href="/basic/javascript/closure.html" class="sidebar-link">闭包</a></li><li><a href="/basic/javascript/Proxy.html" class="sidebar-link">Proxy</a></li><li><a href="/basic/javascript/WeakMap.html" class="sidebar-link">WeakMap</a></li><li><a href="/basic/javascript/Symbol.html" class="sidebar-link">Symbol</a></li><li><a href="/basic/javascript/Reflect.html" class="sidebar-link">Reflect</a></li><li><a href="/basic/javascript/MutationObserver.html" class="sidebar-link">MutationObserver</a></li><li><a href="/basic/javascript/FAQ.html" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>NodeJS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/nodejs/作用域.html" class="sidebar-link">作用域</a></li><li><a href="/basic/nodejs/常用NPM包索引.html" class="sidebar-link">常用NPM包索引</a></li><li><a href="/basic/nodejs/eval和vm.html" class="sidebar-link">eval和vm</a></li><li><a href="/basic/nodejs/debug.html" class="sidebar-link">调试</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>TypeScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/typescript/basic.html" class="sidebar-link">基础篇</a></li><li><a href="/basic/typescript/advanced.html" class="sidebar-link">进阶篇</a></li><li><a href="/basic/typescript/v3.7.html" class="sidebar-link">v3.7</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Browser</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/browser/cors.html" class="sidebar-link">跨域问题</a></li><li><a href="/basic/browser/rendering-principle.html" class="sidebar-link">渲染原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/webpack/webpack4.html" class="sidebar-link">v4.x</a></li><li><a href="/basic/webpack/code-splitting.html" class="sidebar-link">Code Splitting</a></li><li><a href="/basic/webpack/FAQ.html" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/react/react-kernel.html" class="sidebar-link">React核心</a></li><li><a href="/basic/react/redux-kernel.html" class="sidebar-link">Redux核心</a></li><li><a href="/basic/react/FAQ.html" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/vue/vue-loader.html" class="sidebar-link">Vue loader</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Minip</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/minip/FAQ.html" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Network</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/network/网络分层及相关协议.html" class="active sidebar-link">网络分层及相关协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/basic/network/网络分层及相关协议.html#引言" class="sidebar-link">引言</a></li><li class="sidebar-sub-header"><a href="/basic/network/网络分层及相关协议.html#tcp-的建立" class="sidebar-link">TCP 的建立</a></li><li class="sidebar-sub-header"><a href="/basic/network/网络分层及相关协议.html#http-协议" class="sidebar-link">HTTP 协议</a></li><li class="sidebar-sub-header"><a href="/basic/network/网络分层及相关协议.html#https-协议" class="sidebar-link">HTTPS 协议</a></li><li class="sidebar-sub-header"><a href="/basic/network/网络分层及相关协议.html#ssl-认证流程" class="sidebar-link">SSL 认证流程</a></li></ul></li><li><a href="/basic/network/TCPIP.html" class="sidebar-link">TCP/IP分层</a></li><li><a href="/basic/network/cloud.html" class="sidebar-link">云服务</a></li><li><a href="/basic/network/json-web-token.html" class="sidebar-link">JWT简介</a></li><li><a href="/basic/network/Socket和HTTP的联系.html" class="sidebar-link">Socket和HTTP的联系</a></li><li><a href="/basic/network/子网掩码与IP地址的关系.html" class="sidebar-link">子网掩码与IP地址的关系</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Git</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/git/command.html" class="sidebar-link">Git使用</a></li><li><a href="/basic/git/FAQ.html" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/docker/基础篇.html" class="sidebar-link">基础篇</a></li><li><a href="/basic/docker/nginx镜像.html" class="sidebar-link">nginx篇</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>DataBase</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/db/范式.html" class="sidebar-link">范式</a></li><li><a href="/basic/db/关系型数据库表设计.html" class="sidebar-link">关系型数据库表设计</a></li><li><a href="/basic/db/文档型数据库表设计.html" class="sidebar-link">文档型数据库表设计</a></li><li><a href="/basic/db/FAQ.html" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/linux/bash.html" class="sidebar-link">Bash命令</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#引言">引言</a></li><li><a href="#tcp-的建立">TCP 的建立</a><ul><li><a href="#三次握手">三次握手</a></li><li><a href="#四次挥手">四次挥手</a></li><li><a href="#faq">FAQ</a></li></ul></li><li><a href="#http-协议">HTTP 协议</a><ul><li><a href="#faq">FAQ</a></li></ul></li><li><a href="#https-协议">HTTPS 协议</a><ul><li><a href="#faq">FAQ</a></li></ul></li><li><a href="#ssl-认证流程">SSL 认证流程</a><ul><li><a href="#faq">FAQ</a></li></ul></li></ul></div><p></p> <h2 id="引言"><a href="#引言" class="header-anchor">#</a> 引言</h2> <p>计算机网络中，通常有两中分层模型，一种是 OSI 七层模型，另一种是 TCP/IP 四层模型，如下图所示：</p> <p><img src="/assets/img/osi.3921f216.png" alt=""></p> <h2 id="tcp-的建立"><a href="#tcp-的建立" class="header-anchor">#</a> TCP 的建立</h2> <p><img src="/assets/img/tcp_data.74c4e6eb.jpg" alt=""></p> <p>TCP 处于传输层，要建立 TCP 连接，需要进行三次握手，断开连接则需要进行四次挥手。</p> <h3 id="三次握手"><a href="#三次握手" class="header-anchor">#</a> 三次握手</h3> <p><img src="/assets/img/tcp_3.72cf28d3.jpg" alt=""></p> <ol><li>第一次：客户端发起请求，报文段的头部中 SYN=1，ACK=0，seq=x，之后客户端进入 SYN-SENT 状态。SYN=1，ACK=0 表示该报文段为连接请求报文，seq=x 为本次 TCP 通信的字节流的初始序号；</li> <li>第二次：服务端收到后会发送一个应答 SYN=1，ACK=1，seq=y，ack=x+1，之后服务端进入 SYN-RCVD 状态。SYN=1，ACK=1 表示该报文段为连接同意的应答报文，seq=y 表示服务端作为发送者时，发送字节流的初始序号，ack=x+1 表示服务端希望下一个数据报发送序号是从 x+1 开始的字节；</li> <li>第三次：客户端收到后会发送一个应答 ACK=1，seq=x+1，ack=y+1，之后客户端发送后进入 ESTABLISHED 状态，服务端收到这个应答后也进入 ESTABLISHED 状态，此时连接的建立完成。</li></ol> <h3 id="四次挥手"><a href="#四次挥手" class="header-anchor">#</a> 四次挥手</h3> <p><img src="/assets/img/tcp_4.efbeaa50.jpg" alt=""></p> <ol><li>第一次：客户端发起请求，报文段的头部中 FIN=1，seq=u，之后客户端进入 FIN-WAIT-1 状态。FIN=1 表示该报文段是一个连接释放请求；</li> <li>第二次：服务端收到后会发送一个应答 ACK=1，seq=v，ack=u+1，之后服务端进入 CLOSE-WAIT 状态，客户端收到这个应答后进入 FIN-WAIT-2 状态，等待服务端发送连接释放请求；</li> <li>第三次：此时服务端可能还有数据需要传送，当所有数据传输完毕后，向客户端发送连接释放请求 FIN=1，ACK=1，seq=w，ack=u+1。之后服务端进入 LAST-ACK 状态。</li> <li>第四次：客户端收到释放请求后，向服务端发送确认应答，此时客户端进入 TIME-WAIT 状态，该状态会持续 2MSL 时间，若该时间段内没有服务端的重发请求的话，就进入 CLOSED 状态，撤销 TCB。当服务端收到确认应答后，也便进入 CLOSED 状态，撤销 TCB。</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>SYN：synchronous 同步信号。</p> <p>ISN：Initial sequence number，初始序列号。</p> <p>ACK：acknowledgement 确认信号。</p> <p>FIN：finish 结束。</p> <p>RST：reset 重置。</p> <p>MSL：是 Maximum Segment Lifetime 的缩写，表示报文在网络中的最大生存时间，通常为 120 秒。</p> <p>TCB：在两个设备建立连接发送数据之前，双方都必须要先分配内存建立起 TCB 数据块。</p></div> <h3 id="faq"><a href="#faq" class="header-anchor">#</a> FAQ</h3> <ul><li>为什么握手需要三次，挥手需要四次？</li></ul> <p>第一次握手是必然的，第二次握手让客户端知道了服务端的接受能力和应答能力，第三次握手让服务端知道了客户端的接受能力和应答能力；</p> <p>挥手时可能还有在传数据，因此不同于握手。第一次挥手：我（客户端）这边想要断连了，如果你（服务端）数据传完了和我说声；第二次挥手：好的，我（服务端）还有点数据要传送；第三次挥手：我（服务端）数据传完了，你（客户端）好关闭了；第四次挥手：好的，我（客户端）关闭了。</p> <ul><li>为什么第四次挥手时客户端在进入 CLOSED 状态前需要等待 2MSL 时间？</li></ul> <p>为了保证服务端能收到客户端的确认应答，若客户端发完确认应答后直接进入 CLOSED 状态，那么如果该应答丢失，服务端等待超时（通常为 0.5 秒、1 秒、2 秒…16 秒，远小于 MSL 时间）后就会重新发送连接释放请求，但此时客户端已经关闭了，不会作出任何响应，因此服务端永远无法正常关闭（其实服务端的超时重传次数达到上限后会自动 reset）。而定为 2MSL 是因为应答的往返最大时间就是 2MSL。</p> <h2 id="http-协议"><a href="#http-协议" class="header-anchor">#</a> HTTP 协议</h2> <p>HTTP 是基于 TCP/IP 协议之上的应用层协议，定义了 Web 客户端如何从 Web 服务器请求 Web 页面，以及服务器如何把 Web 页面传送给客户端。HTTP 协议采用了请求/响应模型，默认端口为 80。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>http keep-alive 与 tcp keep-alive 不是同一回事。http keep-alive 是为了让 tcp 连接活得更久一点，提高 socket 的效率。而 tcp keep-alive 是 TCP 的一种检测 TCP 连接状况的保鲜机制，当连接很久没有数据报文传输时，tcp 自动发送一个数据为空的报文给对方，如果对方回应了这个报文说明还在线，连接可以继续保持，如果对方没有报文返回，并且重试了多次之后则认为链接丢失，没有必要保持链接。</p></div> <h3 id="faq-2"><a href="#faq-2" class="header-anchor">#</a> FAQ</h3> <ul><li><p>在浏览器地址栏键入 URL，按下回车之后发生了什么？</p> <ol><li>浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址；</li> <li>据这个 IP，找到对应的服务器，发起 TCP 的三次握手建立 TCP 连接；</li> <li>浏览器发起 HTTP 请求；</li> <li>服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器；</li> <li>浏览器解析 html 代码，并请求 html 代码中的资源（如 js、css、图片等）；</li> <li>浏览器对页面进行渲染呈现给用户；</li> <li>关闭 TCP 连接。</li></ol></li> <li><p>HTTP/1.x 和 HTTP/2 的区别？</p> <ul><li>HTTP/1.x 情况下，浏览器和服务端的每个 TCP 连接只允许一个 http 请求，多个请求只能等待前一个请求完成，现代浏览器为了缓节状况通常会打开多个并行的 TCP 连接，通常是 2-8 个，不同浏览器不同。但这终究只是缓解，并没有真正解决问题。</li> <li>HTTP/2 情况下，浏览器和服务器之间的所有请求都在一个 TCP 连接上进行多路复用，节省了 TCP 连接打开和关闭的开销，这不同于 keep-alive，keep-alive 本质依然只能同时承载一个 http 请求，只不过延长了 TCP 连接的时长，减少了建立 TCP 连接的次数。</li></ul></li> <li><p>雪碧图在 HTTP/2 中还有必要吗？</p> <p>在 HTTP/1.x 情况下，通过雪碧图集合可以很好的减少请求数量提升加载速度，这毋庸置疑，但在 HTTP/2，在多路复用的前提下，这还有意义吗？请见<a href="https://blog.octo.com/en/http2-arrives-but-sprite-sets-aint-no-dead/" target="_blank" rel="noopener noreferrer">这篇文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h2 id="https-协议"><a href="#https-协议" class="header-anchor">#</a> HTTPS 协议</h2> <p>HTTPS 协议默认端口为 443，其由 HTTP 和 TLS/SSL 协议组成，其主要目的有三个：</p> <ol><li>数据保密性：保证数据内容在传输的过程中不会被第三方查看</li> <li>数据完整性：及时发现被第三方篡改的传输内容</li> <li>身份校验安全性：保证数据到达用户期望的目的地</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>HTTPS 不防止抓包。它防止两件事情：信息泄漏和信息被篡改。</p> <p>常说的 HTTPS 四次握手=TCP 三次握手+SSL 认证（很多步骤当作一次握手）</p></div> <h3 id="faq-3"><a href="#faq-3" class="header-anchor">#</a> FAQ</h3> <ul><li>浏览器 F12 为什么能看到 HTTPS 的明文</li></ul> <p>浏览器 F12 之所以能看到 HTTPS 的明文，是因为浏览器处在应用层，HTTP 协议是应用层协议，而 SSL/TLS 是传输层协议，报文经过了传输层，SSL/TLS 已经对报文进行了解密处理，到达应用层已经是明文。</p> <h2 id="ssl-认证流程"><a href="#ssl-认证流程" class="header-anchor">#</a> SSL 认证流程</h2> <p><img src="/assets/img/ssl.eedfd754.png" alt=""></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>先建立 TCP 连接（三次握手），然后进行 SSL 认证。</p> <p>当第二步客户端发现无效证书时会弹框提醒。</p></div> <h3 id="faq-4"><a href="#faq-4" class="header-anchor">#</a> FAQ</h3> <ul><li>session ID 是干嘛的？</li></ul> <p>经过 SSL 认证后的数据都会通过 premaster secret 加密后传输，而这个 secret 的交换过程需要经历非对称加密算法，由于非对称加密算法 RSA/DSA 非常耗费 CPU 资源，为了解决这个问题，服务端会把客户端生成的 premaster secret 以 session ID 为索引保存起来，并在 TLS 握手阶段传给客户端，下次客户端再次连接是初始这个 session ID，服务端就能找到对应的 premaster secret，节省性能开销。通常 session ID 寿命只有 1 天，如果在此期间没有新的连接，会被删除。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/basic/minip/FAQ.html" class="prev">
        常见问题
      </a></span> <span class="next"><a href="/basic/network/TCPIP.html">
        TCP/IP分层
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5f1549a3.js" defer></script><script src="/assets/js/2.9121317e.js" defer></script><script src="/assets/js/6.624eac56.js" defer></script>
  </body>
</html>
